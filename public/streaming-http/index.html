<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Streaming HTTP &middot;  Misframe" />
  <meta property="og:site_name" content="Misframe" />
  <meta property="og:url" content="http://localhost:1313/streaming-http" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:author" content="https://facebook.com/PreetamJinka" />
  
  <meta property="og:article:published_time" content="2014-09-02T00:00:00Z" />
  
  

  <title>
     Streaming HTTP &middot;  Misframe
  </title>

  <link rel="stylesheet" href="http://localhost:1313/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://localhost:1313/css/main.css" />
  <link rel="stylesheet" href="http://localhost:1313/css/font-awesome.min.css" />
  <link rel="stylesheet" href="http://localhost:1313/css/github.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="http://localhost:1313/images/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png" />
  
</head>
<body>
  <header class="global-header">
    <section class="header-text">
      <h1><a href="http://localhost:1313/">Misframe</a></h1>
      
      <div class="sns-links hidden-print">
  
  <a href="https://twitter.com/PreetamJinka" target="_blank">
      <i class="fa fa-twitter"></i>
  </a>
  
  
  <a href="https://facebook.com/PreetamJinka" target="_blank">
    <i class="fa fa-facebook"></i>
  </a>
  
  
  <a href="https://github.com/PreetamJinka" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  <a href="https://jp.linkedin.com/in/preetamjinka" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  
</div>

      
      <a href="http://localhost:1313/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left"></i>
        &nbsp;Home
      </a>
      
      
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">Streaming HTTP</h1>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-09-02T00:00:00Z">
          Sep 2, 2014
        </time>
      </div>
      <div class="pull-right">
        
      </div>
    </div>
  </header>
  <section>
    <p>I just came back from this month&rsquo;s
<a href="https://wiki.python.org/moin/CharlottesvillePythonUserGroup">PyCHO</a> meetup,
and one of the things that we discussed was how to handle many simultaneous
HTTP clients that send data in streams.</p>

<p>Someone had a project, written in Python of course, that accepted large file
uploads from clients, computed a hash, and sent it to S3. The goal is to
do everything concurrently with minimal resource usage.</p>

<p>I&rsquo;m not a Python programmer, but as a Go programmer this is very simple to do.
You don&rsquo;t have to worry about threads, processes, coroutines, futures, or
any other concurrency/parallelism primitives as you would with Python. In fact,
the following example doesn&rsquo;t even expose goroutines directly. Even when you
<em>do</em> start to introduce concurrency primitives directly, they&rsquo;re much easier
to reason about.</p>

<p>This example is an extremely simplified version of the project that I whipped
up in a couple of minutes. I wouldn&rsquo;t even call it &ldquo;correct,&rdquo; but it&rsquo;s enough
to get the point across.</p>

<pre><code class="language-go">package main

import (
	&quot;crypto/md5&quot;
	&quot;fmt&quot;
	&quot;io&quot;
	&quot;log&quot;
	&quot;net/http&quot;
)

// HD5Handler computes an MD5 checksum of the HTTP
// body and sends it as a response.
func MD5Handler(w http.ResponseWriter, req *http.Request) {
	hash := md5.New()

	// Copy data from req.Body (an io.Reader) to
	// hash (an io.Writer).
	io.Copy(hash, req.Body)

	req.Body.Close()

	// Write a response
	fmt.Fprintf(w, &quot;%x&quot;, hash.Sum(nil))
}

func main() {
	// Route &quot;/&quot; to the MD5Handler
	http.HandleFunc(&quot;/&quot;, MD5Handler)

	// Start the HTTP server
	err := http.ListenAndServe(&quot;:8080&quot;, nil)
	if err != nil {
		log.Fatal(&quot;ListenAndServe: &quot;, err)
	}
}
</code></pre>

<p>And here is some sample output.</p>

<pre><code>$ go run main.go
</code></pre>

<pre><code>$ # This creates a 100 MB file of random data
$ dd if=/dev/urandom of=test bs=1M count=100
100+0 records in
100+0 records out
104857600 bytes (105 MB) copied, 7.73638 s, 13.6 MB/s

$ time curl -i -X POST -d @test localhost:8080
HTTP/1.1 100 Continue

HTTP/1.1 200 OK
Date: Wed, 03 Sep 2014 02:28:12 GMT
Content-Length: 32
Content-Type: text/plain; charset=utf-8

97ccb418d79d7f69c71d145bd88c643c
real	0m0.360s
user	0m0.106s
sys	0m0.086s
</code></pre>

  </section>
  <footer>
  
    <ul class="pager">
      
      <li class="previous"><a href="http://localhost:1313/rotring-rapid-pro-review"><span aria-hidden="true">&larr;</span> Older</a></li>
      
      
      <li class="next"><a href="http://localhost:1313/llvm">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
    </ul>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'preetamjinka';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
  </footer>
</article>

  </main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
      Copyright &copy; Preetam Jinka
    </div>
    <div class="sns-links hidden-print">
  
  <a href="https://twitter.com/PreetamJinka" target="_blank">
      <i class="fa fa-twitter"></i>
  </a>
  
  
  <a href="https://facebook.com/PreetamJinka" target="_blank">
    <i class="fa fa-facebook"></i>
  </a>
  
  
  <a href="https://github.com/PreetamJinka" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  <a href="https://jp.linkedin.com/in/preetamjinka" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  
</div>

  </footer>

  <script src="http://localhost:1313/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-37425054-1', 'auto');
    ga('send', 'pageview');
  </script>
  
  
</body>
</html>

