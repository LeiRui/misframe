<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Writing a database. &middot;  Misframe" />
  <meta property="og:site_name" content="Misframe" />
  <meta property="og:url" content="http://localhost:1313/writing-a-database" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:author" content="https://facebook.com/PreetamJinka" />
  
  <meta property="og:article:published_time" content="2013-03-04T00:00:00Z" />
  
  

  <title>
     Writing a database. &middot;  Misframe
  </title>

  <link rel="stylesheet" href="http://localhost:1313/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://localhost:1313/css/main.css" />
  <link rel="stylesheet" href="http://localhost:1313/css/font-awesome.min.css" />
  <link rel="stylesheet" href="http://localhost:1313/css/github.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="http://localhost:1313/images/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png" />
  
</head>
<body>
  <header class="global-header">
    <section class="header-text">
      <h1><a href="http://localhost:1313/">Misframe</a></h1>
      
      <div class="sns-links hidden-print">
  
  <a href="https://twitter.com/PreetamJinka" target="_blank">
      <i class="fa fa-twitter"></i>
  </a>
  
  
  <a href="https://facebook.com/PreetamJinka" target="_blank">
    <i class="fa fa-facebook"></i>
  </a>
  
  
  <a href="https://github.com/PreetamJinka" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  <a href="https://jp.linkedin.com/in/preetamjinka" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  
</div>

      
      <a href="http://localhost:1313/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left"></i>
        &nbsp;Home
      </a>
      
      
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">Writing a database.</h1>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-03-04T00:00:00Z">
          Mar 4, 2013
        </time>
      </div>
      <div class="pull-right">
        
      </div>
    </div>
  </header>
  <section>
    

<p>Early last month, I wrote <a href="http://misfra.me/adversaria">Adversaria</a>. I don&rsquo;t have a precise definition for it, but I like to think of it as a tool to store time series data in key-value format. It&rsquo;s really simple but useful. Using Adversaria and a little <a href="http://www.flotcharts.org/">Flot</a> magic, I make graphs like this:
<img src="http://media.tumblr.com/3b5d56788ebf7359244e91ccc396e11f/tumblr_inline_mitdq7RwNC1qz4rgp.png" alt="" />
</p>

<p>A few weeks ago, I decided to take it one step further. I felt that it was time to use whatever I learned to make that ad-hoc data storage solution to write a distributed key-value store.</p>

<p>Here&rsquo;s what I envision: a simple, fast, clustered key-value store. It doesn&rsquo;t sound too useful, does it? No map-reducing, no geospatial queries, no full-text searching, or anything complicated. I think it&rsquo;s more realistic to build something simpler. The point is to not <em>misframe</em>, right?</p>

<h2 id="why:3e44482483312363ba9bae13099d2d2c">Why?</h2>

<p>I&rsquo;ve always believed in <em>learning by doing.</em> Want to learn how a bridge works? Build a model. We did it in middle school using straws and that&rsquo;s a great way of learning the basics of structural integrity. You can try out different methods and fundamentally understand why some things work and others don&rsquo;t. It&rsquo;s a more intuitive approach.</p>

<h2 id="elegance:3e44482483312363ba9bae13099d2d2c">Elegance.</h2>

<p>Elegance is great to think about. How do we keep things simple, yet effective? I feel that anyone could come up with a solution that works, but with a bit of clever thinking and some &ldquo;secret sauce,&rdquo; a more &ldquo;elegant&rdquo; solution can be developed.</p>

<p>A phrase that popped into my head is &ldquo;first-class application logic.&rdquo; I think it describes exactly what I&rsquo;m trying to achieve. I&rsquo;ll elaborate in a future post, but it&rsquo;s essentially a combination of code elegance and run-time efficiency.</p>

<p>Any way, enough about the abstract.</p>

<hr />

<h2 id="how-do-we-store-data:3e44482483312363ba9bae13099d2d2c">How do we store data?</h2>

<p><img src="http://media.tumblr.com/89f5fd2e7e05e269241ef55116d14cbf/tumblr_inline_mix9b3190P1qz4rgp.png" alt="" />
</p>

<p>Adversaria uses TreeMaps internally to store key-values. TreeMaps are great because we can perform range operations like reading a range of values between two keys. For example, I read the values between 48 hours ago and now to make those cool graphs.</p>

<p>Trees can get slow. If we&rsquo;re dealing with billions of keys, insertions and reads can take a while due to the inherent nature of the data structure. We&rsquo;d like to minimize the number of operations we have to make. In that case, it sounds better to go with a hash-based map since we can get fast reads, but then we&rsquo;ll lose the benefit of range operations.</p>

<p>Right now, I&rsquo;m using a balanced binary search tree to store all of the keys in the keyspace. Of course, that means it&rsquo;s sorted and that&rsquo;s what we want. There&rsquo;s also a hash map mapping the keys to their values. I don&rsquo;t think it&rsquo;s efficient to store the keys twice, but an obvious solution isn&rsquo;t coming to mind. I&rsquo;ll keep thinking about it.</p>

<h2 id="fault-tolerance:3e44482483312363ba9bae13099d2d2c">Fault-tolerance?</h2>

<p>This can get rather tricky to implement correctly, I think. I don&rsquo;t really like the idea of master-slave replication. I think it&rsquo;s easier to implement, but ideally that&rsquo;s not what I would want.</p>

<h2 id="transactions:3e44482483312363ba9bae13099d2d2c">Transactions?</h2>

<p>Transactions are important. I recommend reading <a href="http://www.foundationdb.com/white-papers/the-transaction-manifesto/">FoundationDB&rsquo;s Transaction Manifesto</a> for an in-depth look into transactions.</p>

<p>I have no idea how to implement transactions. What data structures should we use? How do we check transaction conflicts? I think finding the answers to these questions will take a bit of whiteboarding.</p>

<p>I like the phrase &ldquo;patch-based transactional collision detection.&rdquo; Not much more to say about that.</p>

<p>Transactions are closely tied together with <a href="https://en.wikipedia.org/wiki/ACID">ACID</a>. I doubt that ACID compliance can be implemented any time soon&hellip;</p>

<h2 id="paranoia:3e44482483312363ba9bae13099d2d2c">Paranoia.</h2>

<p>I think the most important thing about writing a distributed program is paranoia. As far as I know, nothing can be trusted. There are many moving parts in a distributed system and any one of them could fail. Failure should be expected. So, how do we prepare for failure? That&rsquo;ll get answered as this project chugs along, I suppose.</p>

<p>One of the more interesting things about making something like this is that you really have to make it <em>bulletproof.</em> You have to simulate. You have to push the system to the extreme. You have to write test cases.</p>

  </section>
  <footer>
  
    <ul class="pager">
      
      <li class="previous"><a href="http://localhost:1313/cursive-and-handwriting"><span aria-hidden="true">&larr;</span> Older</a></li>
      
      
      <li class="next"><a href="http://localhost:1313/why-i-dont-like-to-use-my-macbook-or-windows">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
    </ul>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'preetamjinka';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
  </footer>
</article>

  </main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
      Copyright &copy; Preetam Jinka
    </div>
    <div class="sns-links hidden-print">
  
  <a href="https://twitter.com/PreetamJinka" target="_blank">
      <i class="fa fa-twitter"></i>
  </a>
  
  
  <a href="https://facebook.com/PreetamJinka" target="_blank">
    <i class="fa fa-facebook"></i>
  </a>
  
  
  <a href="https://github.com/PreetamJinka" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  <a href="https://jp.linkedin.com/in/preetamjinka" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  
</div>

  </footer>

  <script src="http://localhost:1313/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-37425054-1', 'auto');
    ga('send', 'pageview');
  </script>
  
  
</body>
</html>

